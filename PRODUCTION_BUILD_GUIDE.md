# Production Build & Release Guide

This guide covers creating production builds and releasing Auto-Brainlift through GitHub Releases.

## 📋 Prerequisites

### Required Tools
- **Node.js** 18+ and npm
- **Python** 3.8+ (for the app to work)
- **Git** configured with your GitHub account
- **ImageMagick** (for icon generation): `brew install imagemagick`
- **GitHub CLI** (optional but recommended): `brew install gh`

### macOS Code Signing (Optional)
- Apple Developer ID certificate (for signed builds)
- Xcode Command Line Tools: `xcode-select --install`

## 🚀 Quick Release Process

```bash
# 1. Run the release script
./release.sh 1.0.3

# 2. Edit the generated release notes
nano RELEASE_NOTES_v1.0.3.md

# 3. Push to GitHub
git push && git push origin v1.0.3

# 4. Create GitHub release (if gh CLI installed)
gh release create v1.0.3 \
  --title "Auto-Brainlift v1.0.3" \
  --notes-file RELEASE_NOTES_v1.0.3.md \
  dist/*.dmg dist/*.exe dist/*.AppImage dist/*.zip
```

## 🔧 Detailed Build Process

### 1. Prepare Icons

First time setup:
```bash
cd build
./generate-icons.sh
```

This creates:
- `icon.icns` - macOS app icon
- `icon.ico` - Windows app icon  
- `icon.png` - Linux app icon
- `icons/` - Various sizes for Linux

### 2. Clean Build Environment

```bash
# Remove old builds
rm -rf dist/

# Clean Python cache
find . -name "__pycache__" -type d -exec rm -rf {} +
find . -name "*.pyc" -delete
```

### 3. Update Version

```bash
# Update package.json
npm version patch  # or minor/major
```

### 4. Build for Each Platform

#### macOS (Universal Binary)
```bash
npm run build:mac
```

Creates:
- `dist/Auto-Brainlift-{version}-arm64.dmg` - Apple Silicon
- `dist/Auto-Brainlift-{version}-x64.dmg` - Intel
- `dist/Auto-Brainlift-{version}-universal.dmg` - Universal (if configured)

#### Windows
```bash
npm run build:win
```

Creates:
- `dist/Auto-Brainlift-Setup-{version}.exe` - NSIS installer

#### Linux
```bash
npm run build:linux
```

Creates:
- `dist/Auto-Brainlift-{version}.AppImage` - Universal package
- `dist/auto-brainlift_{version}_amd64.deb` - Debian/Ubuntu package

### 5. Test Builds Locally

#### macOS
```bash
# Mount and test DMG
hdiutil attach dist/Auto-Brainlift-*.dmg
open /Volumes/Auto-Brainlift*/Auto-Brainlift.app
```

#### First Run on macOS
Users will see "unidentified developer" warning. Instructions:
1. Right-click the app → Open
2. Click "Open" in the security dialog
3. App will launch normally thereafter

## 📦 GitHub Release Process

### 1. Create Release Notes

Edit `RELEASE_NOTES_v{version}.md`:
```markdown
# Auto-Brainlift v1.0.3

## 🎯 What's New
- ✨ Added WIP analysis for uncommitted changes
- 🐛 Fixed cache persistence issues
- 🚀 Improved startup performance

## 🔧 Improvements
- Better error handling for API failures
- Reduced token usage by 20%
- Updated dependencies

## 📦 Downloads
[Table auto-generated by release script]

## 🚀 Installation
See installation instructions below...
```

### 2. Push to GitHub

```bash
git push
git push origin v1.0.3
```

### 3. Create GitHub Release

#### Option A: GitHub CLI (Recommended)
```bash
gh release create v1.0.3 \
  --title "Auto-Brainlift v1.0.3" \
  --notes-file RELEASE_NOTES_v1.0.3.md \
  dist/*.dmg dist/*.exe dist/*.AppImage dist/*.zip
```

#### Option B: Web Interface
1. Go to: https://github.com/YOUR_USERNAME/auto-brainlift/releases
2. Click "Draft a new release"
3. Choose tag: `v1.0.3`
4. Title: `Auto-Brainlift v1.0.3`
5. Upload all files from `dist/`
6. Paste release notes
7. Publish

## 🍎 macOS Code Signing & Notarization

### Setup (One Time)

1. Get Apple Developer ID certificate
2. Install in Keychain
3. Create app-specific password at appleid.apple.com

### Configure electron-builder

Add to package.json:
```json
{
  "build": {
    "mac": {
      "identity": "Developer ID Application: Your Name (TEAM_ID)",
      "notarize": {
        "appBundleId": "com.autobrainlift.app",
        "appleId": "your@email.com",
        "appleIdPassword": "@keychain:AC_PASSWORD",
        "teamId": "TEAM_ID"
      }
    }
  }
}
```

### Build Signed & Notarized

```bash
# Store password in keychain
xcrun altool --store-password-in-keychain-item "AC_PASSWORD" \
  -u "your@email.com" -p "app-specific-password"

# Build with signing
CSC_NAME="Developer ID Application: Your Name (TEAM_ID)" npm run build:mac
```

## 🔄 Automated Releases with GitHub Actions

Create `.github/workflows/release.yml`:

```yaml
name: Build and Release

on:
  push:
    tags:
      - 'v*'

jobs:
  build:
    strategy:
      matrix:
        include:
          - os: macos-latest
            build: build:mac
          - os: windows-latest
            build: build:win
          - os: ubuntu-latest
            build: build:linux
    
    runs-on: ${{ matrix.os }}
    
    steps:
      - uses: actions/checkout@v3
      
      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'
          
      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'
      
      - name: Install dependencies
        run: npm ci
        
      - name: Generate icons (macOS)
        if: matrix.os == 'macos-latest'
        run: |
          brew install imagemagick
          cd build && ./generate-icons.sh
      
      - name: Build
        run: npm run ${{ matrix.build }}
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      
      - name: Upload artifacts
        uses: actions/upload-artifact@v3
        with:
          name: ${{ matrix.os }}-build
          path: dist/*
          
  release:
    needs: build
    runs-on: ubuntu-latest
    
    steps:
      - uses: actions/checkout@v3
      
      - name: Download all artifacts
        uses: actions/download-artifact@v3
        
      - name: Create Release
        uses: softprops/action-gh-release@v1
        with:
          files: |
            *-build/*
          generate_release_notes: true
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
```

## 📊 Post-Release

### Monitor Downloads
```bash
# View release stats
gh release view v1.0.3

# Download count (requires API)
curl -s https://api.github.com/repos/YOUR_USERNAME/auto-brainlift/releases | \
  jq '.[] | {tag: .tag_name, downloads: [.assets[].download_count] | add}'
```

### Update README

Add badges:
```markdown
[![Latest Release](https://img.shields.io/github/v/release/YOUR_USERNAME/auto-brainlift)](https://github.com/YOUR_USERNAME/auto-brainlift/releases)
[![Downloads](https://img.shields.io/github/downloads/YOUR_USERNAME/auto-brainlift/total)](https://github.com/YOUR_USERNAME/auto-brainlift/releases)
```

## 🐛 Troubleshooting

### Build Fails

1. **Missing icons**: Run `cd build && ./generate-icons.sh`
2. **Old Node version**: Update to Node 18+
3. **Permission errors**: `chmod +x release.sh`

### DMG Not Opening

- Users need to right-click → Open on first run
- For signed apps, ensure notarization completed

### Large Build Size

Add to `.gitignore`:
```
dist/
*.dmg
*.exe
*.AppImage
*.deb
```

## 🚀 Future Enhancements

### Auto-Updates
```bash
npm install electron-updater
```

Configure in main.js:
```javascript
const { autoUpdater } = require('electron-updater');

app.on('ready', () => {
  autoUpdater.checkForUpdatesAndNotify();
});
```

### Windows Code Signing
- Get code signing certificate
- Configure in package.json
- Sign during build process

### Linux Repositories
- Create PPA for Ubuntu
- Submit to Flathub
- AUR package for Arch 